---
title: "障害対応避難訓練やってみた"
emoji: "🕌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [markdown]
published: false
---

こんにちは。リンクウェルの北川です。

私は弊社で開発しているクリフォアの開発チームに所属しています。

https://health.clinicfor.life/app

先日、クリフォア開発チームで障害に強いチームになるために、**障害対応避難訓練**を実施しました。
**障害対応避難訓練**を実施した結果なかなかの学びがあったので、その内容と学んだことをシェアしたいと思います。


## 障害対応避難訓練とは
> テスト環境でわざと障害を発生させて、その障害に対してチームのメンバーが初動調査から解決までを素早く適切に行えるか訓練することを、障害対応避難訓練と呼びます


## なぜ訓練をしたのか
クリフォアはローンチから約1年が経過しました。
クリフォアは幸いにも障害件数は少なく、私が入社して半年が経ちましたがその間も重大な障害は発生していません。
しかし、その結果チームに次のような課題が出てきました。

- チームメンバーの障害に対する感覚が薄れてきている
- 自分を含めて新規Join者が多いので、弊社が行っている障害対応フローがわからない
- いざ障害が発生したときに、素早く対応できない可能性がある
- 障害対応経験はあるメンバーは多いが、インシデントコマンダーの経験はないので取りまとめをできるメンバーが限られる

これらの課題を解決するために、訓練を実施することにしました。

### インシデントコマンダーとは
インシデントコマンダーとは、発生した障害に対して解決へ導く指揮官のことです。
インシデントコマンダーの主な役割は以下の通りです。

- 障害対応の取りまとめ
- ステークホルダーとのコミュニケーション
- 対応状況の整理
- 障害収束の宣言
- 障害報告書の作成指示
- 障害振り返りの開催

つまり、インシデントコマンダーの役割は、発生した障害に対してチームメンバーをリードしつつ素早く解決まで導き、メンバーと障害の再発防止策を検討することが期待する役割となります。

## 訓練で達成したいこと
私たちは以下の3つを訓練で達成したいこととして定義しました。

- 障害が起きた際に行うべきフローの理解
- チームメンバーが協力して素早く障害を解決する能力の強化
- チームメンバー全員がインシデントコマンダーになれる

要するに、「障害対応なんもわからん！」という状態から、「障害が起きたので私たちでなんとかします！」という状態になることが達成したいことになります。
![](https://storage.googleapis.com/zenn-user-upload/5767f1dcaf8e-20240927.png)

## 訓練の内容
### 事前準備
訓練をすると決めてから以下のようなことをしました。

#### 弊社が行っている障害対応の調査
本番に近いフローで訓練を行いたかったので、既存の対応方法はどのようなフローかを事前に調査しました。

#### 関係者への事前周知
本番障害と勘違いして混乱を起こさないために、別チームのリードエンジニアに周知したり、障害対応を行う上で影響がありそうなSlackのチャンネルで事前に周知をしました。

#### 障害対応者に期待する役割を決める
事前に誰に何をして欲しいかを決めました。
今回の訓練では以下の役割で訓練を行いました。
- FlutterエンジニアA
    - インシデントコマンダー
- FlutterエンジニアB
    - 障害調査担当
- RailsエンジニアA
    - 障害調査担当

また私とRailsエンジニアBで、
障害対応の様子を眺め振り返りで気づきをFBするという役を行いました。


### 発生させた障害
クラアントがGraphQLのクエリで指定したフィールドが存在しないバグを仕込み、クリフォアのホーム画面にあるよく見ている診療科カードが表示しない障害を発生させました。

![](https://storage.googleapis.com/zenn-user-upload/5b8ddc56d139-20240928.png)

今回の訓練の目的は障害内容の調査方法を学ぶためではなくフローを理解することが目的だったため、発生させる障害とバグはバックエンド側に仕込むことは事前に共有しました。


### 当日の流れ
障害が発生していることをSlackで共有して訓練スタートです。
![](https://storage.googleapis.com/zenn-user-upload/5bf84be65ae6-20240928.png)

訓練スタート後、関係者はGoogle Meetに集合して次の流れで訓練を行いました。

1. ステークホルダーに障害が起きていることを共有
2. インシデントコマンダーを中心に障害の調査開始
3. 障害の原因を特定
4. 影響範囲や修正目処をステークホルダーに共有
5. 障害の修正・検証
6. 収束の宣言
7. 障害報告書の作成
8. 振り返り

おおよその所要時間は以下のとおりです。
- 障害発生〜収束まで
    - 1時間
- 障害報告書の作成
    - 30分
- 振り返り
    - 30分

## 訓練を実施した結果
弊社で障害対応を行うことが初めだったり、障害対応避難訓練自体が初めてというメンバーが多かったため、多くの混乱がありましたがさまざまな課題が見つかり多くの学びを得ることができました。
参加してくれたメンバーからも振り返りで多くの意見が出てきて、概ね好評だったと思います。
振り返りで出た内容を紹介いたします。
- 訓練とはいえ緊張感があった
    - 本番に近いフローで訓練を行ったので緊張感が生まれ、疲れはしたが、その分多くの学びを得た
- 心理的安全性は大事
    - 障害対応中はピリピリしてしまうこともありそんなかでもコミュニケーションをスムーズに行うために、心理的安全性は確保されていることが大事と感じた
- 言語の統一は大事
    - 障害を止めることを暫定対応・応急処置・止血など呼び方が異っていたので認識がズレる危険性がある
- 今回はオフラインとオンラインのメンバーが混在する形式で行ったが、コミュニケーションが難しかった
    - 混在させずどちらかに寄せた方が良いかもしれない。障害が起きた場合にどのように集まるかは事前に決めておくのが良さそう
- 職域外の話は意思決定しづらい
    - 今回はアプリエンジニアがインシデントコマンダーを務めたが、バックエンドで障害を起こしたことでバックエンドの話に偏った。その結果、技術的な話を完全に理解することができず、意思決定に困る場面があった
- 障害報告書の書き方がわからない
    - 弊社で障害報告書を書いた経験があるメンバーがいなかったため、どのように書けばいいかがわからなかった。慣れも必要だが書きやすようにフォーマットを整えたり、書き方を統一するのが良さそう
- Sentryの重要性を再認識した
    - Sentryを繋げていない環境で訓練をしたため、初動調査が遅れたり影響を受けたユーザー数の把握はできなかったので、普段Sentryにどれだけ助かっているかを再認識した
- 起きている障害に対して認識齟齬が起きていた
    - テキストだけの報告だと人によった解釈が変わるのでまず画像や動画を要求して認識合わせをすることが重要
- アプリで障害が発生した場合はWebに誘導したい
    - アプリの機能はWebでも対応できる機能が多くあるので、障害発生時にすぐにWebに誘導できるような仕組みがあると良さそう

このように本当に多くの意見をいただけました。
意見の中には障害対応に対する意見もあれば訓練自体に対する意見やその他の意見もありました。
課題だなと感じたことは今後解決できるように動いていきたいと思います。

## 終わりに
私自身、障害対応避難訓練をしたのは初めてでしたので、これほどまでに学びを得ることができるとは思っていなかったので、素直に企画して良かったなと思っています。
また障害対応から遠ざかっていたということもあり、このような訓練が有効だなと感じました。
実際に障害が発生することは避けたいですが、障害を完全に無くすことは難しいので、万が一に備えて今回のような障害訓練をすることはとても重要だなと実感しています。
今後もクリフォアチームでは定期的に訓練を行い障害に強いチームを目指していきます。
また、他チームにも今回の学びを共有して、会社全体で障害に強い組織になれるようにしていきます。

もしこの記事を読んだ方の中で、自分のチームは障害慣れしていないなあと思った方は、ぜひ一度障害対応避難訓練を実施することをおすすめします。
