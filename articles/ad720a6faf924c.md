---
title: "障害対応避難訓練やってみた"
emoji: "🕌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [markdown]
published: false
---

こんにちは。リンクウェルの北川です。
クリフォアの開発チームに所属しています。

https://health.clinicfor.life/app

先日、クリフォア開発チームで障害に強いチームになるために、**障害対応避難訓練**を実施しました。この訓練を通して色々と学びがあったので、今回は訓練の紹介や気づきを紹介しようと思います。

## 障害対応避難訓練とは
> テスト環境でわざと障害を発生させて、その障害に対してチームのメンバーが初動調査から解決までを素早く適切に行えるか訓練することを、障害対応避難訓練と呼びます。


## なんで訓練をしたの？
クリフォアはローンチから約1年が経過しました。クリフォアは幸いにも障害件数は少なく、私が入社して半年が経ちましたがその間も重大な障害は発生していません。
しかし、その結果こんな課題が見えてきました。

- 障害に対する感覚が薄れている
- 新メンバーが増えて、障害対応フローが分からない
- いざ障害が起きても、すぐに動けるか心配
- インシデントコマンダー経験がないメンバーが多い

これらの課題を解決するために、訓練を実施することにしました。

### インシデントコマンダーとは
>インシデントコマンダーとは、発生した障害に対して解決へ導く指揮官のことです。
インシデントコマンダーの役割は、発生した障害に対してチームメンバーをリードしつつ素早く解決まで導き、メンバーと障害の再発防止策を考えることが主な役割となります。

https://www.pagerduty.co.jp/blog/what-is-incident-commander

## 訓練で達成したいこと
訓練で達成したいこと以下の3つです。

1. 障害対応フローの理解
2. チームで協力して障害を解決する力の強化
3. チーム全員がインシデントコマンダーをできるように

ざっくり言うと、「障害対応が全然分からん！」から「なんとかします！」と言える状態になることが目標です。
![](https://storage.googleapis.com/zenn-user-upload/5767f1dcaf8e-20240927.png)

## 訓練の内容
### 事前準備
訓練をするために事前に準備を行いました。

#### 障害対応フローの確認
本番に近い形で訓練したいので、既存のフローを確認しました。

#### 関係者への事前周知
本番障害と勘違いして混乱しないために、事前に訓練することを伝えました。

#### 役割を決める
訓練の役割を決めました。
FlutterエンジニアAにインシデントコマンダーをお願いして、調査担当者は2人としています。

#### 障害内容を決める
GraphQLのクエリにバグを仕込んで、ホーム画面の診療科カードが表示されない問題を発生させました。今回の訓練の目的は障害フローを理解することなので障害の内容は事前に共有しました。
また、安全に実施するためにローカル環境で行いました。

![](https://storage.googleapis.com/zenn-user-upload/5b8ddc56d139-20240928.png)

### 当日の流れ
障害が発生していることをSlackで共有して訓練スタートです。
![](https://storage.googleapis.com/zenn-user-upload/5bf84be65ae6-20240928.png)

訓練スタート後、関係者はGoogle Meetに集合して以下の流れで行いました。

1. ステークホルダーに障害が起きていることを共有
2. インシデントコマンダーを中心に障害の調査開始
3. 障害の原因を特定
4. 影響範囲や修正目処をステークホルダーに共有
5. 障害の修正・検証
6. 収束の宣言
7. 障害報告書の作成
8. 振り返り

おおよその所要時間は以下のとおりです。
- 障害発生〜収束まで
    - 1時間
- 障害報告書の作成
    - 30分
- 振り返り
    - 30分

## 訓練を実施した結果
訓練の流れは決めていたものの想定外のことが起きて混乱はありましたが、さまざまな学びを得ました。今回の学びについていくつか紹介したいと思います。

### 障害内容の認識がズレる
障害報告がテキストだけだったので、内容の解釈がメンバー間でズレました。画像や動画も要求して認識を揃えるのが大事だと実感しました。

### 言葉の統一が必要
同じ意味のことを、メンバーが違う言葉で表現していたことがありました。例えば、障害の暫定対応を応急処置や止血と表現していました。ユビキタス言語を作り共通の言葉を決めておくことで、スムーズな対応ができると感じました。

### オンライン・オフラインの混在は難しい
弊社はフルリモートOKなので、普段出社できるメンバーもいればできないメンバーもいるので、オフラインとオンラインを混ぜたハイブリッド形式で訓練を行いました。その結果、コミュニケーションが難しくなることがあったので、どちらかに寄せた方が良さそうです。

### 専門外の判断が難しい
Flutterエンジニアがインシデントコマンダーを務めたため、バックエンドの障害対応に対する意思決定をする場面で判断に困ることがありました。
これに対する有効な解決策は出ていないのですが、調査者に任せる柔軟さは必要と思いました

### 障害報告書のフォーマット改善
障害報告書のフォーマットはあるのですが報告書の書き方が統一されておらず、書き慣れていないメンバーが悩むことがありました。簡単に書けるようにフォーマットのアップデートを進めていきます。

### Sentryの重要性を再認識した
弊社では障害通知にSentryを活用しているのですが、ローカル環境はSentryを繋げていないため、調査に影響がありました。これによりローカル環境でもSentryを繋げようという改善タスクができたので非常に良かったです。

### 暫定対応案の考案
クリフォアアプリの機能はWebで対応できる機能が多くあるので、障害発生時にすぐにWebに誘導できる仕組みがあると便利だという話が出ました。

## まとめ
今回の訓練を通じて、障害対応の大切さや改善点が見えてきました。訓練を通して、チームとしても個人としても成長できたと感じています。今後も定期的に訓練を行い、障害に強いチームを目指していこうと思います。また、今回の学びはクリフォア開発チームに留めず他チームにも共有し、全社で障害に強い組織を目指していきます。

もし、自分のチームが障害対応に不安を感じているなら、ぜひ一度訓練をしてみるのをおすすめします。
